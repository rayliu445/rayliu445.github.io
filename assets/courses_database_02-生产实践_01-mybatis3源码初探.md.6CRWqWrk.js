import{_ as n}from"./chunks/ArticleMetadata.d4_nZKBO.js";import{_ as o,D as c,o as t,c as p,I as u,w as d,k as i,a as m,R as h,b,e as g}from"./chunks/framework.FHZ5yb6k.js";import"./chunks/md5.0oexlRJv.js";const U=JSON.parse('{"title":"01-MyBatis源码","description":"","frontmatter":{"title":"01-MyBatis源码","author":"查尔斯","date":"2026/01/09 09:00:00","categories":["Mybatis"],"tags":["Mybatis"],"showArticleMetadata":false,"editLink":false,"lastUpdated":false,"showComment":false},"headers":[],"relativePath":"courses/database/02-生产实践/01-mybatis3源码初探.md","filePath":"courses/database/02-生产实践/01-mybatis3源码初探.md","lastUpdated":1768389245000}'),j={name:"courses/database/02-生产实践/01-mybatis3源码初探.md"},f=i("h1",{id:"mybatis源码",tabindex:"-1"},[m("MyBatis源码 "),i("a",{class:"header-anchor",href:"#mybatis源码","aria-label":'Permalink to "MyBatis源码"'},"​")],-1),y=h(`<h2 id="背景" tabindex="-1">背景 <a class="header-anchor" href="#背景" aria-label="Permalink to &quot;背景&quot;">​</a></h2><p>优秀的文章推荐</p><p><a href="https://github.com/waylau/jdbc-specification/blob/master/2.Goals.md" target="_blank" rel="noreferrer">JDBC规范(JDBC 4.2 规范中文版本)</a></p><p><a href="https://www.cnblogs.com/ZhangZiSheng001/p/12704076.html" target="_blank" rel="noreferrer">Mybatis初始化讲解</a></p><h2 id="mybatis-启动初始化和查询执行流程" tabindex="-1">MyBatis 启动初始化和查询执行流程 <a class="header-anchor" href="#mybatis-启动初始化和查询执行流程" aria-label="Permalink to &quot;MyBatis 启动初始化和查询执行流程&quot;">​</a></h2><p>我们总要知道需要从哪里看吧，总不能像个无头苍蝇一样瞎看，否则就是在感动自己，看上去点了点源码，实际上啥也没学到。现在有了AI，可以让AI帮忙圈出重点</p><h3 id="启动初始化流程" tabindex="-1">启动初始化流程 <a class="header-anchor" href="#启动初始化流程" aria-label="Permalink to &quot;启动初始化流程&quot;">​</a></h3><h4 id="_1-sqlsessionfactory-创建阶段" tabindex="-1">1. <strong>SqlSessionFactory 创建阶段</strong> <a class="header-anchor" href="#_1-sqlsessionfactory-创建阶段" aria-label="Permalink to &quot;1. **SqlSessionFactory 创建阶段**&quot;">​</a></h4><ul><li><strong>[SqlSessionFactoryBuilder.build()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/session/SqlSessionFactoryBuilder.java#L32-L98)</strong> → 读取配置文件</li><li><strong>[XMLConfigBuilder.parse()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/builder/xml/XMLConfigBuilder.java#L100-L105)</strong> → 解析 mybatis-config.xml</li><li><strong>[Configuration](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/session/Configuration.java#L102-L1199)</strong> → 构建配置对象，初始化各种注册表</li></ul><h4 id="_2-mapper-解析阶段" tabindex="-1">2. <strong>Mapper 解析阶段</strong> <a class="header-anchor" href="#_2-mapper-解析阶段" aria-label="Permalink to &quot;2. **Mapper 解析阶段**&quot;">​</a></h4><ul><li><strong>[MapperRegistry.addMapper()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/binding/MapperRegistry.java#L60-L73)</strong> → 注册 Mapper 接口</li><li><strong>[MapperAnnotationBuilder.parse()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/builder/annotation/MapperAnnotationBuilder.java#L135-L152)</strong> → 解析 Mapper 注解</li><li><strong>[XMLMapperBuilder.parse()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/builder/xml/XMLMapperBuilder.java#L85-L104)</strong> → 解析 XML 映射文件</li><li><strong>[MappedStatement](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/mapping/MappedStatement.java#L34-L357)</strong> → 创建映射语句对象</li></ul><h3 id="mapper-查询执行完整流程" tabindex="-1">Mapper 查询执行完整流程 <a class="header-anchor" href="#mapper-查询执行完整流程" aria-label="Permalink to &quot;Mapper 查询执行完整流程&quot;">​</a></h3><h4 id="_1-mapper-接口调用" tabindex="-1">1. <strong>Mapper 接口调用</strong> <a class="header-anchor" href="#_1-mapper-接口调用" aria-label="Permalink to &quot;1. **Mapper 接口调用**&quot;">​</a></h4><ul><li><strong>[MapperProxy.invoke()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/binding/MapperProxy.java#L59-L82)</strong> → Mapper 接口的动态代理入口</li><li><strong>[MapperMethod.execute()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/binding/MapperMethod.java#L51-L159)</strong> → 解析方法签名，执行相应操作</li></ul><h4 id="_2-查询执行阶段" tabindex="-1">2. <strong>查询执行阶段</strong> <a class="header-anchor" href="#_2-查询执行阶段" aria-label="Permalink to &quot;2. **查询执行阶段**&quot;">​</a></h4><ul><li><strong>[SqlSession.selectList()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/session/defaults/DefaultSqlSession.java#L123-L133)</strong> → 通过 SqlSession 执行查询</li><li><strong>[BaseExecutor.query()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/BaseExecutor.java#L126-L157)</strong> → 执行器基类查询方法</li><li><strong>[CachingExecutor.query()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/CachingExecutor.java#L58-L85)</strong> → 如果启用二级缓存，先检查缓存</li></ul><h4 id="_3-sql-准备阶段" tabindex="-1">3. <strong>SQL 准备阶段</strong> <a class="header-anchor" href="#_3-sql-准备阶段" aria-label="Permalink to &quot;3. **SQL 准备阶段**&quot;">​</a></h4><ul><li><strong>[BaseExecutor.createCacheKey()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/BaseExecutor.java#L238-L279)</strong> → 创建查询缓存键</li><li><strong>[BaseExecutor.queryFromDatabase()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/BaseExecutor.java#L334-L347)</strong> → 从数据库查询</li><li><strong>[SimpleExecutor.doQuery()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/SimpleExecutor.java#L63-L74)</strong> → 执行具体查询</li></ul><h4 id="_4-statement-创建和执行" tabindex="-1">4. <strong>Statement 创建和执行</strong> <a class="header-anchor" href="#_4-statement-创建和执行" aria-label="Permalink to &quot;4. **Statement 创建和执行**&quot;">​</a></h4><ul><li><strong>[Configuration.newStatementHandler()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/session/Configuration.java#L660-L672)</strong> → 创建语句处理器</li><li><strong>[PreparedStatementHandler.prepare()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/statement/PreparedStatementHandler.java#L41-L59)</strong> → 准备 PreparedStatement</li><li><strong>[PreparedStatementHandler.query()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/statement/PreparedStatementHandler.java#L61-L77)</strong> → 执行查询</li></ul><h4 id="_5-结果处理阶段" tabindex="-1">5. <strong>结果处理阶段</strong> <a class="header-anchor" href="#_5-结果处理阶段" aria-label="Permalink to &quot;5. **结果处理阶段**&quot;">​</a></h4><ul><li><strong>[DefaultResultSetHandler.handleResultSets()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/resultset/DefaultResultSetHandler.java#L119-L171)</strong> → 处理结果集</li><li><strong>[DefaultResultSetHandler.handleResultSet()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/resultset/DefaultResultSetHandler.java#L173-L216)</strong> → 处理单个结果集</li><li><strong>[DefaultResultSetHandler.getRowValue()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/resultset/DefaultResultSetHandler.java#L551-L584)</strong> → 从结果行创建对象</li><li><strong>[DefaultResultSetHandler.applyAutomaticMappings()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/resultset/DefaultResultSetHandler.java#L586-L632)</strong> → 自动映射结果到对象</li></ul><h3 id="完整线路图" tabindex="-1">完整线路图 <a class="header-anchor" href="#完整线路图" aria-label="Permalink to &quot;完整线路图&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>Mapper 接口调用</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>[MapperProxy.invoke()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/binding/MapperProxy.java#L59-L82)</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>[MapperMethod.execute()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/binding/MapperMethod.java#L51-L159)</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>[SqlSession.selectList()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/session/defaults/DefaultSqlSession.java#L123-L133)</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>[CachingExecutor.query()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/CachingExecutor.java#L58-L85)</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>[BaseExecutor.query()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/BaseExecutor.java#L126-L157)</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>[SimpleExecutor.doQuery()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/SimpleExecutor.java#L63-L74)</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>[PreparedStatementHandler.query()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/statement/PreparedStatementHandler.java#L61-L77)</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>[DefaultResultSetHandler.handleResultSets()](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/resultset/DefaultResultSetHandler.java#L119-L171)</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>返回结果对象</span></span></code></pre></div><h3 id="关键类和切入点" tabindex="-1">关键类和切入点 <a class="header-anchor" href="#关键类和切入点" aria-label="Permalink to &quot;关键类和切入点&quot;">​</a></h3><ul><li><strong>启动入口</strong>: [SqlSessionFactoryBuilder](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/session/SqlSessionFactoryBuilder.java#L32-L98) → [XMLConfigBuilder](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/builder/xml/XMLConfigBuilder.java#L53-L442)</li><li><strong>执行入口</strong>: [MapperProxy](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/binding/MapperProxy.java#L34-L120) → [MapperMethod](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/binding/MapperMethod.java#L46-L385)</li><li><strong>执行核心</strong>: [BaseExecutor](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/BaseExecutor.java#L47-L375) → [StatementHandler](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/statement/StatementHandler.java#L30-L48) → [ResultSetHandler](file:///Users/liulei/IdeaProjects/mybatis-3/src/main/java/org/apache/ibatis/executor/resultset/ResultSetHandler.java#L27-L35)</li></ul>`,26);function L(a,v,P,x,S,M){const r=n,l=c("ClientOnly");return t(),p("div",null,[f,u(l,null,{default:d(()=>{var e,s;return[(((e=a.$frontmatter)==null?void 0:e.aside)??!0)&&(((s=a.$frontmatter)==null?void 0:s.showArticleMetadata)??!0)?(t(),b(r,{key:0,article:a.$frontmatter},null,8,["article"])):g("",!0)]}),_:1}),y])}const B=o(j,[["render",L]]);export{U as __pageData,B as default};
