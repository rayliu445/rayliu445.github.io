<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>写在前面 | Ray的博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="...">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.364d6764.js" as="script"><link rel="preload" href="/assets/js/2.c95ed0ff.js" as="script"><link rel="preload" href="/assets/js/1.a9a94530.js" as="script"><link rel="preload" href="/assets/js/28.dbdcfdba.js" as="script"><link rel="prefetch" href="/assets/js/10.a80dc50e.js"><link rel="prefetch" href="/assets/js/11.041e0b47.js"><link rel="prefetch" href="/assets/js/12.4b5ad5b9.js"><link rel="prefetch" href="/assets/js/13.7e492cf4.js"><link rel="prefetch" href="/assets/js/14.7d21639b.js"><link rel="prefetch" href="/assets/js/15.ea37f0ce.js"><link rel="prefetch" href="/assets/js/16.87d00f92.js"><link rel="prefetch" href="/assets/js/17.893858a3.js"><link rel="prefetch" href="/assets/js/18.90116347.js"><link rel="prefetch" href="/assets/js/19.2a696a53.js"><link rel="prefetch" href="/assets/js/20.23ba6b64.js"><link rel="prefetch" href="/assets/js/21.31e32fb9.js"><link rel="prefetch" href="/assets/js/22.bb7a1599.js"><link rel="prefetch" href="/assets/js/23.3b2898a6.js"><link rel="prefetch" href="/assets/js/24.d3a9decb.js"><link rel="prefetch" href="/assets/js/25.f5747bc7.js"><link rel="prefetch" href="/assets/js/26.c2407826.js"><link rel="prefetch" href="/assets/js/27.a049de19.js"><link rel="prefetch" href="/assets/js/29.4f8e0e2c.js"><link rel="prefetch" href="/assets/js/3.300d7081.js"><link rel="prefetch" href="/assets/js/30.447b27cb.js"><link rel="prefetch" href="/assets/js/31.00d2fc58.js"><link rel="prefetch" href="/assets/js/32.37aab673.js"><link rel="prefetch" href="/assets/js/33.e1085ab5.js"><link rel="prefetch" href="/assets/js/34.7e73222f.js"><link rel="prefetch" href="/assets/js/35.1e140592.js"><link rel="prefetch" href="/assets/js/36.0d0db906.js"><link rel="prefetch" href="/assets/js/37.abaaed04.js"><link rel="prefetch" href="/assets/js/4.2e183bf6.js"><link rel="prefetch" href="/assets/js/5.e50c6310.js"><link rel="prefetch" href="/assets/js/6.2cf8d884.js"><link rel="prefetch" href="/assets/js/7.809e3600.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.cf80bbd5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Ray的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web3/" class="nav-link router-link-active">
  web3
</a></div><div class="nav-item"><a href="/后端/" class="nav-link">
  后端
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="链接" class="dropdown-title"><span class="title">链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="链接" class="mobile-dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/mqyqingfeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/712139234359182/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web3/" class="nav-link router-link-active">
  web3
</a></div><div class="nav-item"><a href="/后端/" class="nav-link">
  后端
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="链接" class="dropdown-title"><span class="title">链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="链接" class="mobile-dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/mqyqingfeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/712139234359182/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/web3/" class="sidebar-heading clickable router-link-active open"><span>web3</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/web3/basic/" class="sidebar-heading clickable"><span>basic</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/web3/basic/以太坊术语.html" class="sidebar-link">以太坊术语</a></li><li><a href="/web3/basic/区块链入门.html" class="sidebar-link">区块链入门</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/web3/evm/" class="sidebar-heading clickable router-link-active open"><span>evm</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/web3/evm/Solidity学习笔记.html" class="active sidebar-link">Solidity学习笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#认识合约" class="sidebar-link">认识合约</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#数据类型" class="sidebar-link">数据类型</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#变量数据存储和作用域-重点" class="sidebar-link">变量数据存储和作用域(重点)</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#变量初始化" class="sidebar-link">变量初始化</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#控制流" class="sidebar-link">控制流</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#构造函数和修饰器" class="sidebar-link">构造函数和修饰器</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#事件" class="sidebar-link">事件</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#继承" class="sidebar-link">继承</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#抽象合约和接口" class="sidebar-link">抽象合约和接口</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#异常" class="sidebar-link">异常</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#库合约" class="sidebar-link">库合约</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#import" class="sidebar-link">import</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#接收eth和发送eth" class="sidebar-link">接收ETH和发送ETH</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#调用其他合约" class="sidebar-link">调用其他合约</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#call-delegatecall" class="sidebar-link">call&amp;Delegatecall</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#create-create2" class="sidebar-link">create&amp;create2</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#删除合约" class="sidebar-link">删除合约</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#abi编码和解码" class="sidebar-link">ABI编码和解码</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#哈希" class="sidebar-link">哈希</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#选择器" class="sidebar-link">选择器</a></li><li class="sidebar-sub-header"><a href="/web3/evm/Solidity学习笔记.html#try-catch" class="sidebar-link">Try Catch</a></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/%E5%90%8E%E7%AB%AF/" class="sidebar-heading clickable"><span>后端</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/%E5%90%8E%E7%AB%AF/Go/" class="sidebar-heading clickable open"><span>Go</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-2"><a href="/%E5%90%8E%E7%AB%AF/Go/GoBasic/" class="sidebar-heading clickable open"><span>GoBasic</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/后端/Go/GoBasic/GoBasic.html" class="sidebar-link">GoBasic</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/%E5%90%8E%E7%AB%AF/Java/" class="sidebar-heading clickable"><span>Java</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-2"><a href="/%E5%90%8E%E7%AB%AF/Java/JavaBasic/" class="sidebar-heading clickable open"><span>JavaBasic</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/后端/Java/JavaBasic/JavaBasic.html" class="sidebar-link">JavaBasic</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><a href="/%E5%90%8E%E7%AB%AF/Java/JavaConcurrency/" class="sidebar-heading clickable"><span>JavaConcurrency</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/后端/Java/JavaConcurrency/高并发程序设计读书笔记.html" class="sidebar-link">高并发程序设计读书笔记</a></li></ul></section></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="写在前面"><a href="#写在前面" class="header-anchor">#</a> 写在前面</h3> <p>本篇笔记参考的教程是WTF学院的101和102的lab，官方的文档我也有看过但是中文版读起来很奇怪，所以就选择了这个教程。我跟学下来觉得很赞，每一小节都有测验来检查我们吸收的怎么样，强烈推荐。103的lab我看了一下都是各个方向的实际应用讲解，我后面单读写吧，因为我觉得每个方向都还是需要一些基础概念做打底的。</p> <h2 id="认识合约"><a href="#认识合约" class="header-anchor">#</a> 认识合约</h2> <p>合约就是在区块链基础上运行的程序(数据+操作)，区块链保存交易信息，合约中的操作就相当于交易需要消耗gas，同时区块链中还会保存合约中的状态变量，所以读取合约的状态变量也是交易，也需要消耗gas费用。</p> <h2 id="数据类型"><a href="#数据类型" class="header-anchor">#</a> 数据类型</h2> <p>和其他语言入门一样，Solidity也是从数据类型开始讲起，我学习前端语言(js，ts)和其他后端语言(python)也是如此。</p> <h3 id="值类型"><a href="#值类型" class="header-anchor">#</a> 值类型</h3> <h4 id="整型"><a href="#整型" class="header-anchor">#</a> 整型</h4> <p>常见的写法</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token builtin">int</span> <span class="token keyword">public</span> _int<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//整数，包括负数</span>
<span class="token builtin">uint</span> <span class="token keyword">public</span> _uint <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//无符号整数</span>
<span class="token builtin">uint256</span> <span class="token keyword">public</span> _number <span class="token operator">=</span><span class="token number">20220330</span><span class="token punctuation">;</span> <span class="token comment">//256位无符号整数</span>
</code></pre></div><h4 id="布尔类型"><a href="#布尔类型" class="header-anchor">#</a> 布尔类型</h4> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token builtin">bool</span> <span class="token keyword">public</span> _bool1<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="逻辑运算"><a href="#逻辑运算" class="header-anchor">#</a> 逻辑运算</h5> <p>！、&amp;&amp;、||、==、!=</p> <h4 id="地址类型"><a href="#地址类型" class="header-anchor">#</a> 地址类型</h4> <p>这个算是solidity里面比较特殊的一个了，我们知道合约都是EOA和CA。在合约中我们也需要用到地址，所以就有了这种类型。</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token builtin">address</span> <span class="token keyword">public</span> _address<span class="token operator">=</span><span class="token number">0x7A58c0Be72BE218B41C608b7Fe7C5bB630736C71</span><span class="token punctuation">;</span>
<span class="token builtin">address</span> <span class="token keyword">payable</span> poublic _address1<span class="token operator">=</span> <span class="token keyword">payable</span><span class="token punctuation">(</span>_address<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">uint256</span> <span class="token keyword">public</span> balance<span class="token operator">=</span>address1<span class="token punctuation">.</span>balance<span class="token punctuation">;</span>
</code></pre></div><h5 id="普通地址"><a href="#普通地址" class="header-anchor">#</a> 普通地址</h5> <p>存储一个20字节的值(以太坊地址)的大小。</p> <h5 id="payable-address"><a href="#payable-address" class="header-anchor">#</a> payable address</h5> <p>比普通地址多了transfer和send(两个都是用于转账的方法)，后面会提到</p> <h4 id="定长字节数组"><a href="#定长字节数组" class="header-anchor">#</a> 定长字节数组</h4> <h5 id="定长字节数组-2"><a href="#定长字节数组-2" class="header-anchor">#</a> 定长字节数组</h5> <p>声明以后不能改变</p> <h5 id="不定长字节数组"><a href="#不定长字节数组" class="header-anchor">#</a> 不定长字节数组</h5> <p>属于引用类型，数组长度可更改</p> <div class="language- extra-class"><pre class="language-text"><code>// 固定长度的字节数组
bytes32 public _byte32 = &quot;MiniSolidity&quot;;
</code></pre></div><p>注：byte_其实就是byte32的第一个字节了。</p> <h4 id="枚举"><a href="#枚举" class="header-anchor">#</a> 枚举</h4> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// 用enum将uint 0， 1， 2表示为Buy, Hold, Sell</span>
<span class="token keyword">enum</span> <span class="token class-name">ActionSet</span> <span class="token punctuation">{</span> Buy<span class="token punctuation">,</span> Hold<span class="token punctuation">,</span> Sell <span class="token punctuation">}</span>
<span class="token comment">// 创建enum变量 action</span>
ActionSet action <span class="token operator">=</span> ActionSet<span class="token punctuation">.</span>Buy<span class="token punctuation">;</span>
</code></pre></div><h3 id="函数类型-重点"><a href="#函数类型-重点" class="header-anchor">#</a> 函数类型(重点)</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token operator">&lt;</span><span class="token keyword">function</span> name<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">[</span>parameter types<span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">internal</span><span class="token operator">|</span><span class="token keyword">external</span><span class="token operator">|</span><span class="token keyword">public</span><span class="token operator">|</span><span class="token keyword">private</span><span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token keyword">pure</span><span class="token operator">|</span><span class="token keyword">view</span><span class="token operator">|</span><span class="token keyword">payable</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>virtual<span class="token operator">|</span>override<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>modifiers<span class="token operator">&gt;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">return</span> types<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">{</span> <span class="token operator">&lt;</span><span class="token keyword">function</span> body<span class="token operator">&gt;</span> <span class="token punctuation">}</span>

</code></pre></div><ol><li>函数名</li> <li>parameter types[,....]参数</li> <li>{internalexternal|public|private}:可见性说明符
public:内外部均可见
private:只能从合约内部访问，继承的也不能用
external:只能从外部访问(但是内部可以通过this.f()来调用)
internal:只能从合约内部访问，继承的合约可以用</li> <li>[pure|view|payable] 决定函数权限/功能的关键字
被pure修饰的方法里面不能读合约状态变量，也不写
view修饰可读不可写
payalbe就是调用的时候可以转账(默认是往往合约里面转账)，这里教程说的太简单了，其实意思是函数在调用时可以接收函数，我猜测是先转到合约账户里，如果有需要的话转到指定账户地址(方法体中实现)</li> <li>[virtual|override] 方法是否可以被重写</li> <li><code>&lt;modifiers&gt;</code> 函数修饰器，相当于装饰器模式的在语言中直接体现了</li> <li><code>&lt;function body&gt; 函数体。</code></li></ol> <h4 id="函数输出"><a href="#函数输出" class="header-anchor">#</a> 函数输出</h4> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// 返回多个变量</span>
<span class="token keyword">function</span> <span class="token function">returnMultiple</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">memory</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token builtin">uint256</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>returns定义了函数应该返回什么样的形式，而return返回了实际的值。</p> <h3 id="引用类型"><a href="#引用类型" class="header-anchor">#</a> 引用类型</h3> <h4 id="数组array"><a href="#数组array" class="header-anchor">#</a> 数组Array</h4> <p>用来存储一组数据(整数、字节，地址等等)</p> <h5 id="固定长度数组"><a href="#固定长度数组" class="header-anchor">#</a> 固定长度数组</h5> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// 固定长度 Array</span>
<span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> array1<span class="token punctuation">;</span>
<span class="token builtin">bytes1</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> array2<span class="token punctuation">;</span>
<span class="token builtin">address</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span> array3<span class="token punctuation">;</span>
</code></pre></div><h5 id="可变长度数组"><a href="#可变长度数组" class="header-anchor">#</a> 可变长度数组</h5> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// 可变长度 Array</span>
<span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array4<span class="token punctuation">;</span>
<span class="token builtin">bytes1</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array5<span class="token punctuation">;</span>
<span class="token builtin">address</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array6<span class="token punctuation">;</span>
<span class="token builtin">bytes</span> array7<span class="token punctuation">;</span>
<span class="token comment">//bytes比较特殊，是数组，但是不用加[]，单字节要用bytes或者bytes1</span>
</code></pre></div><h5 id="数组常用成员"><a href="#数组常用成员" class="header-anchor">#</a> 数组常用成员</h5> <p>length、push()、push(x)和pop()</p> <h4 id="结构体struct"><a href="#结构体struct" class="header-anchor">#</a> 结构体struct</h4> <p>通过结构体的形式定义新的类型。</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">struct</span> <span class="token class-name">Student</span><span class="token punctuation">{</span>
  <span class="token builtin">uint256</span> id<span class="token punctuation">;</span>
  <span class="token builtin">uint256</span> score<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="映射类型"><a href="#映射类型" class="header-anchor">#</a> 映射类型</h3> <p>非常常见，就是哈希表。</p> <h4 id="映射mapping"><a href="#映射mapping" class="header-anchor">#</a> 映射Mapping</h4> <p>声明映射的格式为 <code>mapping(_KeyType =&gt; _ValueType)</code></p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint</span> <span class="token operator">=&gt;</span> <span class="token builtin">address</span><span class="token punctuation">)</span> <span class="token keyword">public</span> idToAddress<span class="token punctuation">;</span> <span class="token comment">// id映射到地址</span>
<span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token builtin">address</span><span class="token punctuation">)</span> <span class="token keyword">public</span> swapPair<span class="token punctuation">;</span> <span class="token comment">// 币对的映射，地址到地址</span>
</code></pre></div><h4 id="映射的规则"><a href="#映射的规则" class="header-anchor">#</a> 映射的规则</h4> <ol><li>_KeyType只能选择Solidity内置的值类型，比如uint，address等。</li> <li>映射的存储位置必须是storage,因此用于合约的状态变量(这个存储位置后面我们会提到)</li> <li>如果映射声明为public，那么Solidity会自动给你创建一个getter函数，可以通过Key来查询对应的Value。</li> <li>给新映射的键值对赋值的语法位_Var[_Key]=_Value;</li></ol> <h3 id="常数"><a href="#常数" class="header-anchor">#</a> 常数</h3> <p><code>constant</code>（常量）和 <code>immutable</code>（不变量）。状态变量声明这两个关键字之后，不能在初始化后更改数值。这样做的好处是提升合约的安全性并节省 <code>gas。</code></p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token builtin">uint256</span> <span class="token keyword">constant</span> CONSTANT_NUM <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//constant需要在声明的时候就初始化</span>

<span class="token builtin">address</span> <span class="token keyword">public</span> immutable IMMUTABLE_ADDRESS<span class="token punctuation">;</span><span class="token comment">//不需要显示初始化，若是显式初始化的话即可声明初始化，也可以构造函数初始化，但是以constructor为准。</span>

</code></pre></div><h2 id="变量数据存储和作用域-重点"><a href="#变量数据存储和作用域-重点" class="header-anchor">#</a> 变量数据存储和作用域(重点)</h2> <h3 id="数据位置"><a href="#数据位置" class="header-anchor">#</a> 数据位置</h3> <h4 id="storage-重点"><a href="#storage-重点" class="header-anchor">#</a> storage(重点)</h4> <p>存储在链上，消耗gas最多，也是合约变量中默认的存储位置</p> <h4 id="memory-calldata"><a href="#memory-calldata" class="header-anchor">#</a> memory&amp;calldata</h4> <p>memory:函数里的参数和临时变量一般用memory，存储在内存中，不上链。尤其是<strong>如果返回数据类型是变长的情况下</strong>，必须加memory修饰，例如：string，bytes，array和自定义结构。</p> <p>calldata:和memory类似，存储在内存中，不上链。与memory的不同点在<strong>于calldata变量不能修改(immutable)</strong>,一般用户函数的参数。</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">fCalldata</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">calldata</span> _x<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">calldata</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token punctuation">(</span>_x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="数据位置和赋值规则"><a href="#数据位置和赋值规则" class="header-anchor">#</a> 数据位置和赋值规则</h3> <p>在不同存储类型相互赋值的时候，有时会产生独立的副本(修改新变量不会影响远变量)，有时会产生引用(修改新变量会影响原变量)，规则如下：</p> <ol><li>将storage赋值给storage的时候，会创建引用，改变新变量会影响原变量。<div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 状态变量：数组 x</span>

<span class="token keyword">function</span> <span class="token function">fStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">{</span>
    <span class="token comment">//声明一个storage的变量 xStorage，指向x。修改xStorage也会影响x</span>
    <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">storage</span> xStorage <span class="token operator">=</span> x<span class="token punctuation">;</span>
    xStorage<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div></li> <li>memory赋值给memory的时候，也会创建引用，修改新变量会影响原变量。</li></ol> <p>其他情况下，比如将storage赋值给memory的时候，会创建独立副本，修改新变量不会影响原变量。</p> <h3 id="变量作用域"><a href="#变量作用域" class="header-anchor">#</a> 变量作用域</h3> <h4 id="状态变量"><a href="#状态变量" class="header-anchor">#</a> 状态变量</h4> <p>存储在链上的变量，所有合约函数都可以访问。这也解释了为什么默认存储位置是storage</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">contract</span> <span class="token class-name">Variables</span> <span class="token punctuation">{</span>
  <span class="token builtin">uint</span> <span class="token keyword">public</span> x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">uint</span> <span class="token keyword">public</span> y<span class="token punctuation">;</span>
  <span class="token builtin">string</span> <span class="token keyword">public</span> z<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="局部变量"><a href="#局部变量" class="header-anchor">#</a> 局部变量</h4> <p>函数执行过程中有效的变量，函数退出后，变量无效。不上链，gas低。</p> <h4 id="全局变量"><a href="#全局变量" class="header-anchor">#</a> 全局变量</h4> <p>solidity预留的关键字，他们可以不声明而直接使用。</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">global</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">,</span><span class="token builtin">uint</span><span class="token punctuation">,</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token builtin">address</span> sender<span class="token operator">=</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
   <span class="token builtin">uint</span> blockNum<span class="token operator">=</span>block<span class="token punctuation">.</span>number<span class="token punctuation">;</span>
   <span class="token builtin">byte</span> <span class="token keyword">memory</span> data<span class="token operator">=</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">;</span>s
   <span class="token keyword">return</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span>blockNum<span class="token punctuation">,</span>datass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>msg.value 当前交易发送的wei值。</p> <p>msg.sender 消息的发送者，也就是调用合约函数的地址。</p> <p>msg.data 发起交易的完整calldata。</p> <h3 id="全局变量-以太单位和时间单位"><a href="#全局变量-以太单位和时间单位" class="header-anchor">#</a> 全局变量-以太单位和时间单位</h3> <ol><li>以太单位
在基础篇上讲过，solidity中不存在小数点，以0代题为小数点。
wei:1</li> <li>时间单位
可以规定一个操作必须在一周内完成</li></ol> <div class="language- extra-class"><pre class="language-text"><code>seconds: 1
minutes: 60 seconds = 60
hours: 60 minutes = 3600
days: 24 hours = 86400
weeks: 7 days = 604800
</code></pre></div><h2 id="变量初始化"><a href="#变量初始化" class="header-anchor">#</a> 变量初始化</h2> <h3 id="值类型默认初始值"><a href="#值类型默认初始值" class="header-anchor">#</a> 值类型默认初始值</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token builtin">bool</span> <span class="token keyword">public</span> _bool<span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token builtin">string</span> <span class="token keyword">public</span> _string<span class="token punctuation">;</span> <span class="token comment">// &quot;&quot;</span>
<span class="token builtin">int</span> <span class="token keyword">public</span> _int<span class="token punctuation">;</span> <span class="token comment">// 0</span>
<span class="token builtin">uint</span> <span class="token keyword">public</span> _uint<span class="token punctuation">;</span> <span class="token comment">// 0</span>
<span class="token builtin">address</span> <span class="token keyword">public</span> _address<span class="token punctuation">;</span> <span class="token comment">// 0x0000000000000000000000000000000000000000</span>

<span class="token keyword">enum</span> <span class="token class-name">ActionSet</span> <span class="token punctuation">{</span> Buy<span class="token punctuation">,</span> Hold<span class="token punctuation">,</span> Sell<span class="token punctuation">}</span>
ActionSet <span class="token keyword">public</span> _enum<span class="token punctuation">;</span> <span class="token comment">// 第1个内容Buy的索引0</span>

<span class="token keyword">function</span> <span class="token function">fi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">internal</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// internal空白函数</span>
<span class="token keyword">function</span> <span class="token function">fe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// external空白函数 </span>
span
</code></pre></div><h3 id="引用类型默认初始值"><a href="#引用类型默认初始值" class="header-anchor">#</a> 引用类型默认初始值</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// Reference Types</span>
<span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token keyword">public</span> _staticArray<span class="token punctuation">;</span> <span class="token comment">// 所有成员设为其默认值的静态数组[0,0,0,0,0,0,0,0]</span>
<span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">public</span> _dynamicArray<span class="token punctuation">;</span> <span class="token comment">// `[]`</span>
<span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint</span> <span class="token operator">=&gt;</span> <span class="token builtin">address</span><span class="token punctuation">)</span> <span class="token keyword">public</span> _mapping<span class="token punctuation">;</span> <span class="token comment">// 所有元素都为其默认值的mapping</span>
<span class="token comment">// 所有成员设为其默认值的结构体 0, 0</span>
<span class="token keyword">struct</span> <span class="token class-name">Student</span><span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> id<span class="token punctuation">;</span>
    <span class="token builtin">uint256</span> score<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
Student <span class="token keyword">public</span> student<span class="token punctuation">;</span>

</code></pre></div><p><strong>delete操作符</strong></p> <p>delete a会让变量a的值变为初始值</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code>boolean <span class="token keyword">public</span> _bool2<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">d</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span><span class="token punctuation">{</span>
   <span class="token keyword">delete</span> _bool2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="控制流"><a href="#控制流" class="header-anchor">#</a> 控制流</h2> <h3 id="控制流-2"><a href="#控制流-2" class="header-anchor">#</a> 控制流</h3> <p>if-else</p> <p>for循环</p> <p>while循环</p> <p>do-while循环</p> <p>三元运算符</p> <h2 id="构造函数和修饰器"><a href="#构造函数和修饰器" class="header-anchor">#</a> 构造函数和修饰器</h2> <h3 id="构造函数"><a href="#构造函数" class="header-anchor">#</a> 构造函数</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token builtin">address</span> owner<span class="token punctuation">;</span>

<span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> initialOwner<span class="token punctuation">)</span><span class="token punctuation">{</span>
   owner<span class="token operator">=</span>initialOwner<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="修饰器"><a href="#修饰器" class="header-anchor">#</a> 修饰器</h3> <p>对于方法添加判断或者增加一些额外功能</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">modifier</span> onlyOwner<span class="token punctuation">{</span>
  <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token operator">==</span>owner<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">_</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代onlyOwner修饰符的函数只能被owner地址调用</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">changeOwner</span><span class="token punctuation">(</span><span class="token builtin">address</span> _newOwner<span class="token punctuation">)</span> <span class="token keyword">external</span> onlyOwner<span class="token punctuation">{</span>
   owner<span class="token operator">=</span>_newOwner<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="事件"><a href="#事件" class="header-anchor">#</a> 事件</h2> <h3 id="事件-2"><a href="#事件-2" class="header-anchor">#</a> 事件</h3> <p>其实就是EVM日志的抽象，它有两个特点：</p> <p>响应：应用程序(ethers.js)可以通过RPC接口订阅和监听这些事件，并在前端做响应。</p> <p>经济：事件是EVM上比较经济的存储数据的方式，每个大概消耗2000 gas;相比之下，链上存储一个新变量至少需要20000 gas。</p> <h3 id="声明事件"><a href="#声明事件" class="header-anchor">#</a> 声明事件</h3> <p>事件的声明event关键字开头，接着是事件名称，括号里面写好事件需要记录的变量类型和变量名。</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">event</span> <span class="token function">Transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">indexed</span> <span class="token keyword">from</span><span class="token punctuation">,</span><span class="token builtin">address</span> <span class="token keyword">indexed</span> to<span class="token punctuation">,</span><span class="token builtin">uint256</span> value<span class="token punctuation">)</span>
</code></pre></div><h3 id="释放事件"><a href="#释放事件" class="header-anchor">#</a> 释放事件</h3> <p>可以在函数里面释放事件。</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">_transfer</span><span class="token punctuation">(</span>
    <span class="token builtin">address</span> <span class="token keyword">from</span><span class="token punctuation">,</span>
    <span class="token builtin">address</span> to<span class="token punctuation">,</span>
    <span class="token builtin">uint256</span> amount
<span class="token punctuation">)</span><span class="token keyword">external</span><span class="token punctuation">{</span>
    _balances<span class="token punctuation">[</span><span class="token keyword">from</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">10000000</span><span class="token punctuation">;</span>
    _balances<span class="token punctuation">[</span><span class="token keyword">from</span><span class="token punctuation">]</span><span class="token operator">-=</span>amount<span class="token punctuation">;</span>
    _balances<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token operator">+=</span>amount<span class="token punctuation">;</span>

    <span class="token keyword">emit</span> <span class="token function">Transfer</span><span class="token punctuation">(</span><span class="token keyword">from</span><span class="token punctuation">,</span>to<span class="token punctuation">,</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="evm日志"><a href="#evm日志" class="header-anchor">#</a> EVM日志</h3> <p><img src="image/Solidity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1739985836113.png" alt="1739985836113"></p> <h3 id="主题-数据-data"><a href="#主题-数据-data" class="header-anchor">#</a> 主题&amp;数据&amp;data</h3> <p>日志的第一部分是主题数组，用于描述事件，长度不能超过 <code>4</code></p> <p>除了事件哈希，主题还可以包含至多 <code>3</code>个 <code>indexed</code>参数，也就是 <code>Transfer</code>事件中的 <code>from</code>和 <code>to</code>。</p> <p>data中存储了不带indexed的数据</p> <h2 id="继承"><a href="#继承" class="header-anchor">#</a> 继承</h2> <p>继承是面向对象编程很重要的组成部分，可以显著减少重复代码。</p> <ul><li><code>virtual</code>: 父合约中的函数，如果希望子合约重写，需要加上 <code>virtual</code>关键字。</li> <li><code>override</code>：子合约重写了父合约中的函数，需要加上 <code>override</code>关键字。</li></ul> <h3 id="简单继承-多重继承"><a href="#简单继承-多重继承" class="header-anchor">#</a> 简单继承&amp;多重继承</h3> <p>多重继承就是一个子合约有多个父合约</p> <h3 id="修饰器的继承-构造函数的继承"><a href="#修饰器的继承-构造函数的继承" class="header-anchor">#</a> 修饰器的继承&amp;构造函数的继承</h3> <p>修饰器和方法一样，这里构造函数继承比较特殊</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// 构造函数的继承</span>
abstract <span class="token keyword">contract</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint</span> <span class="token keyword">public</span> a<span class="token punctuation">;</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        a <span class="token operator">=</span> _a<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ss</p> <ol><li>在继承时声明父构造函数的参数，例如：<code>contract B is A(1)</code></li> <li>在子合约的构造函数中声明构造函数的参数，例如：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>   contract C is A {
       constructor(uint _c) A(_c * _c) {}
   }
</code></pre></div><h3 id="函数的重载和重写"><a href="#函数的重载和重写" class="header-anchor">#</a> 函数的重载和重写</h3> <p>和Java中一样，也是有重载的概念的，即名字相同但是输入参数类型不同的函数可以同时存在(函数签名不同)</p> <h3 id="调用父合约的函数"><a href="#调用父合约的函数" class="header-anchor">#</a> 调用父合约的函数</h3> <ol><li>直接调用<div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">callParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">{</span>
    Yeye<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>super关键字<div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">callParentSuper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">{</span>
    <span class="token comment">// 将调用最近的父合约函数，Baba.pop()</span>
    super<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="钻石继承"><a href="#钻石继承" class="header-anchor">#</a> 钻石继承</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">/* 继承树：
  God
 /  \
Adam Eve
 \  /
people
*/</span>
</code></pre></div><h2 id="抽象合约和接口"><a href="#抽象合约和接口" class="header-anchor">#</a> 抽象合约和接口</h2> <h3 id="抽象合约"><a href="#抽象合约" class="header-anchor">#</a> 抽象合约</h3> <p>合约里至少有一个未实现的函数，即某个函数缺少主体{}中的内容，则合约必须用abstract修饰。</p> <h3 id="接口"><a href="#接口" class="header-anchor">#</a> 接口</h3> <p>对于一组功能的抽象，不实现任何功能。</p> <ol><li>不能包含状态变量</li> <li>不能包含构造函数</li> <li>不能继承除接口外的其他合约</li> <li>所有函数都必须是external且不能有函数体</li> <li>继承接口的非抽象合约必须实现接口定义的所有功能</li></ol> <h2 id="异常"><a href="#异常" class="header-anchor">#</a> 异常</h2> <h3 id="error"><a href="#error" class="header-anchor">#</a> ERROR</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code>error <span class="token function">TransferNotOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">transferOwner1</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span><span class="token builtin">address</span> newOwner<span class="token punctuation">)</span> <span class="token keyword">public</span><span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>_owners<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span><span class="token operator">!=</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">revert</span> <span class="token function">TransferNotOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   _owners<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span><span class="token operator">=</span>newOwner<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="require"><a href="#require" class="header-anchor">#</a> Require</h3> <p>gas随着描述异常的字符串长度增加</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">transferOwner2</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span><span class="token builtin">address</span> newOwner<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">require</span><span class="token punctuation">(</span>_owners<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span><span class="token string">&quot;Transfer Not Owner&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   _owners<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span><span class="token operator">=</span>newOwner<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="assert"><a href="#assert" class="header-anchor">#</a> Assert</h3> <p>不能解释抛出异常的原因</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">transferOwner3</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span><span class="token builtin">address</span> newOwner<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">assert</span><span class="token punctuation">(</span>_owners<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
   _owners<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span><span class="token operator">=</span>newOwner<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="库合约"><a href="#库合约" class="header-anchor">#</a> 库合约</h2> <p>特殊合约，定义的用的library关键字，是一系列函数的合集，为了提升Solidity代码的复用性和减少gas费用。</p> <ol><li>不能存在状态变量</li> <li>不能够继承或者被继承</li> <li>不能接收以太币</li> <li>不可以被销毁。</li></ol> <h3 id="如何使用"><a href="#如何使用" class="header-anchor">#</a> 如何使用</h3> <p>using for</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// 利用using for指令</span>
<span class="token keyword">using</span> <span class="token class-name">Strings</span> <span class="token keyword">for</span> <span class="token builtin">uint256</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getString1</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> _number<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 库合约中的函数会自动添加为uint256型变量的成员</span>
    <span class="token keyword">return</span> _number<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>库合约名称调用函数</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// 直接通过库合约名调用</span>
<span class="token keyword">function</span> <span class="token function">getString2</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> _number<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> Strings<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>_number<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="import"><a href="#import" class="header-anchor">#</a> import</h2> <p>其实我感觉有import就可以了，不知道为啥还需要上面库合约，import其实就是在一个文件中引用另一个文件的内容。</p> <h3 id="import用法"><a href="#import用法" class="header-anchor">#</a> import用法</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">import</span> <span class="token string">'https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/Address.sol'</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="接收eth和发送eth"><a href="#接收eth和发送eth" class="header-anchor">#</a> 接收ETH和发送ETH</h2> <h3 id="接收eth"><a href="#接收eth" class="header-anchor">#</a> 接收ETH</h3> <h4 id="接收eth函数receive"><a href="#接收eth函数receive" class="header-anchor">#</a> 接收ETH函数receive</h4> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// 定义事件</span>
<span class="token keyword">event</span> <span class="token function">Received</span><span class="token punctuation">(</span><span class="token builtin">address</span> Sender<span class="token punctuation">,</span> <span class="token builtin">uint</span> Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 接收ETH时释放Received事件</span>
<span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">{</span>
    <span class="token keyword">emit</span> <span class="token function">Received</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="回退函数fallback"><a href="#回退函数fallback" class="header-anchor">#</a> 回退函数fallback</h4> <p>会在调用合约不存在的函数时被处罚。可用于接收ETH,也可以用于代理合约proxy contract。</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">event</span> <span class="token function">fallbackCalled</span><span class="token punctuation">(</span><span class="token builtin">address</span> Sender<span class="token punctuation">,</span><span class="token builtin">uint</span> Value<span class="token punctuation">,</span><span class="token builtin">bytes</span> Data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span><span class="token punctuation">{</span>
    <span class="token keyword">emit</span> <span class="token function">fallbackCalled</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">,</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="receive和fallback的区别"><a href="#receive和fallback的区别" class="header-anchor">#</a> receive和fallback的区别</h4> <div class="language- extra-class"><pre class="language-text"><code>触发fallback() 还是 receive()?
           接收ETH
              |
         msg.data是空？
            /  \
          是    否
          /      \
receive()存在?   fallback()
        / \
       是  否
      /     \
receive()   fallback()

</code></pre></div><h3 id="发送eth"><a href="#发送eth" class="header-anchor">#</a> 发送ETH</h3> <ol><li><p>transfer
用法是接收发地址.transfer(发送ETH数额)，限制是2300，足够用于转帐，但对方合约的fallback()或receive()函数不能实现太复杂的逻辑，转帐失败会自动revert</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// 用transfer()发送ETH</span>
<span class="token keyword">function</span> <span class="token function">transferETH</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">payable</span> _to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amount<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span><span class="token punctuation">{</span>
    _to<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>send</p> <p>用法是接收方地址.send(发送ETH数额)，send的限制也是2300，和上面面一样，足够用于转账，但对方合约的fallback()或者receive()函数不能实现太复杂的逻辑，send()如果转账失败，不会revert，send()的返回值是bool，代表着转账成功或者失败，需要额外代码处理一下。</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code>error <span class="token function">SendFailed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sendETH</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">payable</span> _to<span class="token punctuation">,</span><span class="token builtin">uint256</span> amount<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span><span class="token punctuation">{</span>
   <span class="token builtin">bool</span> success<span class="token operator">=</span>_to<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">revert</span> <span class="token function">SendFailed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>call
用法是接收方地址.call{value:发送ETH数额}(&quot;&quot;)。
call没有gas费用限制，需要手动转账失败情况。</p></li></ol> <h2 id="调用其他合约"><a href="#调用其他合约" class="header-anchor">#</a> 调用其他合约</h2> <h3 id="通过合约地址调用"><a href="#通过合约地址调用" class="header-anchor">#</a> 通过合约地址调用</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">callSetX</span><span class="token punctuation">(</span><span class="token builtin">address</span> _Address<span class="token punctuation">,</span><span class="token builtin">uint256</span> x<span class="token punctuation">)</span> <span class="token keyword">external</span><span class="token punctuation">{</span>
    <span class="token function">OtherContract</span><span class="token punctuation">(</span>_Address<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setX</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="传入合约变量调用"><a href="#传入合约变量调用" class="header-anchor">#</a> 传入合约变量调用</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">callGetX</span><span class="token punctuation">(</span>OtherContract _Address<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span>
   x<span class="token operator">=</span>_Address<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="将地址参数创建为合约变量调用"><a href="#将地址参数创建为合约变量调用" class="header-anchor">#</a> 将地址参数创建为合约变量调用</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">callGetX2</span><span class="token punctuation">(</span><span class="token builtin">address</span> _Address<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">uint</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span>
    OtherContract oc<span class="token operator">=</span><span class="token function">OtherContract</span><span class="token punctuation">(</span>_Address<span class="token punctuation">)</span><span class="token punctuation">;</span>
    x<span class="token operator">=</span>oc<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="调用合约并发送"><a href="#调用合约并发送" class="header-anchor">#</a> 调用合约并发送</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">setXTransferETH</span><span class="token punctuation">(</span><span class="token builtin">address</span> otherContract<span class="token punctuation">,</span><span class="token builtin">uint256</span> x<span class="token punctuation">)</span> <span class="token keyword">payable</span> <span class="token keyword">external</span><span class="token punctuation">{</span>
   <span class="token function">OtheContract</span><span class="token punctuation">(</span>otherContract<span class="token punctuation">)</span><span class="token punctuation">.</span>setX<span class="token punctuation">{</span>value<span class="token punctuation">:</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="call-delegatecall"><a href="#call-delegatecall" class="header-anchor">#</a> call&amp;Delegatecall</h2> <p>call不仅可以转账，还可以用来调用其他合约函数</p> <h3 id="call的使用规则"><a href="#call的使用规则" class="header-anchor">#</a> call的使用规则</h3> <p>目标合约地址.call(字节码);</p> <p>abi.encodeWithSignature(&quot;函数签名&quot;,逗号分隔的具体参数);</p> <p>另外call在调用合约时可以指定交易发送的ETH数额和gas数额</p> <p>目标合约地址.call{value:发送数额,gas:gas数额}(字节码);</p> <p>我们直接通过代码来看吧</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">callSetX</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">payable</span> _addr<span class="token punctuation">,</span><span class="token builtin">uint256</span> x<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span><span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">,</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span> data<span class="token punctuation">)</span><span class="token operator">=</span>_addr<span class="token punctuation">.</span>call<span class="token punctuation">{</span>value<span class="token punctuation">:</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">(</span>
        abi<span class="token punctuation">.</span><span class="token function">encodeWithSignature</span><span class="token punctuation">(</span><span class="token string">&quot;seteX(uint256)&quot;</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="delegatecall使用规则"><a href="#delegatecall使用规则" class="header-anchor">#</a> Delegatecall使用规则</h3> <p>solidity中大型项目为了将逻辑结构和存储结构隔离开，就出现了代理合约。</p> <p>delegatecall其实就是委托代理调用，用来增强方法???</p> <p>代码更加直观</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code>funciton <span class="token function">delegatecallSetVars</span><span class="token punctuation">(</span><span class="token builtin">address</span> _addr<span class="token punctuation">,</span><span class="token builtin">uint</span> _num<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">,</span><span class="token builtin">byte</span> <span class="token keyword">memory</span> data<span class="token punctuation">)</span>_addr<span class="token punctuation">.</span><span class="token function">delegatecall</span><span class="token punctuation">(</span>
     abi<span class="token punctuation">.</span><span class="token function">encodeWithSignature</span><span class="token punctuation">(</span><span class="token string">&quot;setVars(uint256)&quot;</span><span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>假如说有A,B,C3个合约，正常A-&gt;B-&gt;C的话，那么c的被调用函数的上下文就是B的，但是如果走了代理那么就是A</p> <h2 id="create-create2"><a href="#create-create2" class="header-anchor">#</a> create&amp;create2</h2> <p>去中心化交易所uniswap利用工厂合约(PairFactory)创建了无数的币对合约</p> <h3 id="create"><a href="#create" class="header-anchor">#</a> create</h3> <p>就是通过new一个新合约，并传入新合约构造函数所需的参数</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code>Contract x<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Contract</span><span class="token punctuation">{</span>Value<span class="token punctuation">:</span>_value<span class="token punctuation">}</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="极简uniswap"><a href="#极简uniswap" class="header-anchor">#</a> 极简Uniswap</h3> <p>有两个核心的合约，UniswapV2Pair:币对合约，用于管理币对地址、流动性和买卖;UninswapV2Factory:工厂合约，用于创建新的币对，并管理币对地址。</p> <p>这里代码就不放出来了，不然纯抄了哈哈哈</p> <h3 id="create2"><a href="#create2" class="header-anchor">#</a> create2</h3> <p>新地址 = hash(创建者地址, nonce)，这是传统的地址的计算方式，nonce是递增的，导致每次生成的都不一样</p> <h4 id="create2如何计算地址"><a href="#create2如何计算地址" class="header-anchor">#</a> create2如何计算地址</h4> <ol><li>0xFF:一个常数，避免和CREATE冲突</li> <li>CreatorAddress:调用CREATE2的当前合约(创建)地址。</li> <li>salt(盐):一个创建者指定的bytes32类型的值，它的主要目的是用来影响新创建的合约的地址。</li> <li>initcode:新合约的初始字节码(合约的Creation Code和构造函数的参数)
其实就是预先计算出合约的地址，有些时候我们需要升级或替换现有的合约，使用CREATE2可以保证地址部署在相同的地址上。</li></ol> <h2 id="删除合约"><a href="#删除合约" class="header-anchor">#</a> 删除合约</h2> <p>selfdestruct(_addr);
将合约剩余数额转至调用者。</p> <h2 id="abi编码和解码"><a href="#abi编码和解码" class="header-anchor">#</a> ABI编码和解码</h2> <p>ABI (Application Binary Interface，应用二进制接口)是与以太坊智能合约交互的标准，给前端的也是这个东西。</p> <h3 id="常用函数"><a href="#常用函数" class="header-anchor">#</a> 常用函数</h3> <p>abi.encode、abi.encodePacked、abi.encodeWithSignature和abi.encodeWithSelector</p> <h3 id="使用场景"><a href="#使用场景" class="header-anchor">#</a> 使用场景</h3> <ol><li>在合约中，配合call来实现对合约的底层调用</li></ol> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token builtin">bytes4</span> selector <span class="token operator">=</span> <span class="token keyword">contract</span><span class="token punctuation">.</span>getValue<span class="token punctuation">.</span>selector<span class="token punctuation">;</span>

<span class="token builtin">bytes</span> <span class="token keyword">memory</span> data <span class="token operator">=</span> abi<span class="token punctuation">.</span><span class="token function">encodeWithSelector</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> _x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> returnedData<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">contract</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">staticcall</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">require</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> abi<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>returnedData<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>ethers.js常用ABI来实现合约的导入和函数调用</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> wavePortalContract <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ethers<span class="token punctuation">.</span>Contract</span><span class="token punctuation">(</span>contractAddress<span class="token punctuation">,</span> contractABI<span class="token punctuation">,</span> signer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
* Call the getAllWaves method from your Smart Contract
*/</span>
<span class="token keyword">const</span> waves <span class="token operator">=</span> <span class="token keyword">await</span> wavePortalContract<span class="token punctuation">.</span><span class="token function">getAllWaves</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="哈希"><a href="#哈希" class="header-anchor">#</a> 哈希</h2> <h3 id="keccak256"><a href="#keccak256" class="header-anchor">#</a> Keccak256</h3> <p><code>Keccak256</code>函数是 <code>Solidity</code>中最常用的哈希函数，用法非常简单：</p> <div class="language- extra-class"><pre class="language-text"><code>哈希 = keccak256(数据);
</code></pre></div><h2 id="选择器"><a href="#选择器" class="header-anchor">#</a> 选择器</h2> <h3 id="如何使用-2"><a href="#如何使用-2" class="header-anchor">#</a> 如何使用</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// 使用selector来调用函数</span>
<span class="token keyword">function</span> <span class="token function">callWithSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span><span class="token punctuation">{</span>
	<span class="token comment">//...</span>
   <span class="token comment">// 调用elementaryParamSelector函数</span>
   <span class="token punctuation">(</span><span class="token builtin">bool</span> success1<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> data1<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodeWithSelector</span><span class="token punctuation">(</span><span class="token number">0x3ec37834</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="methodid和参数"><a href="#methodid和参数" class="header-anchor">#</a> methodId和参数</h3> <p>计算一个方法的methodId</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">mintSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bytes4</span> mSelector<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token builtin">bytes4</span><span class="token punctuation">(</span><span class="token function">keccak256</span><span class="token punctuation">(</span><span class="token string">&quot;mint(address)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="try-catch"><a href="#try-catch" class="header-anchor">#</a> Try Catch</h2> <p>只能用于external函数或者public函数或者创建合约时constructor</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token builtin">uint</span> amount<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">)</span><span class="token punctuation">{</span>
   try even<span class="token punctuation">.</span><span class="token function">onlyEven</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bool</span> _success<span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">emit</span> <span class="token function">SuccessEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> _success<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>catch <span class="token function">Error</span><span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span> reason<span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">emit</span> <span class="token function">CatchEvent</span><span class="token punctuation">(</span>reasonßß<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web3/basic/区块链入门.html" class="prev">
        区块链入门
      </a></span> <span class="next"><a href="/后端/Go/GoBasic/GoBasic.html">
        GoBasic
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.364d6764.js" defer></script><script src="/assets/js/2.c95ed0ff.js" defer></script><script src="/assets/js/1.a9a94530.js" defer></script><script src="/assets/js/28.dbdcfdba.js" defer></script>
  </body>
</html>
