---
title: HTTP图解学习随笔
author: Ray
date: 2025/04/02 07:00
categories:
 - 计算机基础
tags:
 - 计算机网络
showArticleMetadata: false
editLink: false
lastUpdated: false
showComment: false
---
# HTTP图解学习随笔

参考资料---《图解HTTP协议》

## 一、了解Web及网络基础

在开始之前，我们需要了解一个概念-**协议**，我的理解是通信双方要遵守的约定。例如，我们规定了Web页面要使用html语言来写,例如规定了双方通信时如何探测目标，例如硬件(路由器、计算机)在接入互联网时应该选择什么样的光缆。

### 使用HTTP协议访问Web

目的是为了访问某个服务器上的资源而诞生出一种协议。

### HTTP的诞生

方便知识共享的万维网(world wide web)
http0.9->http1.0->http->1.0,目前都已经到2.x版本了。

### 网络基础TCP/IP(重点)

#### 什么是TCP/IP协议族

这里所讲的是TCP/IP协议族，协议族中包含大量的协议，其中较为重要的是**TCP协议和IP协议**，协议中存在着各式各样的内容，电缆的规格、IP地址的选定方法、寻找异地用户的方法、双方建立通信的顺序以及Web页面的加载顺序等等。

#### TCP/IP的分层管理

通过各种协议的作用结合计算机网络，我们将协议进行分层。

##### 应用层

决定了向用户提供**应用服务通信**时的活动，例如使用浏览器访问某个页面，不难想到，HTTP协议就位于这一层。
TCP/IP协议族中预存了各类通信时的服务。例如，FTP(FIle Transfer Protocol,文件传输协议)和DNS(Domain Name System,域名系统);

##### 传输层

传输层对上层应用层，体统处于网络连接中的**两台计算机之间的数据传输**。例如，访问B站时 ，个人计算机和B站服务器(计算机)之间的数据传输。
有两个性质不同的协议：**TCP(Transmissiion Control Protocool,传输控制协议)和UDP(User Data Protocol,用户控制协议)**:

##### 网络层

网络层用来**处理网络上流动的数据包**。数据包是网络传输的最小数据单位。该层规定了通过**怎样的路径(传输路径)到达对方的计算机，并把数据包传送给对方**。

##### 链路层

用来处理网络的**硬件部分**。包括操作系统、硬件的设备驱动、NIC(Network InterFace Card,网络适配器)，及光钎等物理可见部分。

#### TCP/IP的通信传输流

我们来梳理一下网络通信时的协议族中的各个协议在各层发挥的作用。
![](https://raw.githubusercontent.com/aryangzhu/blogImage/master/blogImage/images/TCP-IP传输流.png)
发送端从应用层往下走，接收端则是从下往上走。
书中的例子是HTTP,首先作为发送端的**客户端在应用层发送(HTTP协议)一个想看某个Web页面的HTTP请求**。
然后，在传输层(TCP协议)将HTTP请求分成**一个个数据包**，再在各个数据上打上**标记序号和发送IP地址**。
到了网络层(IP协议)，将在各个数据包加上**MAC(地址每台硬件独一无二的标识)**。
接收端的服务器在**链路层接收到数据包**，再传给上层。
发送端每经过一层将会加上一个**协议首部**，在接收端会逐层解析后去掉。

### 与HTTP关系密切的协议：IP、TCP&DNS

#### 负责传输的IP协议

IP协议的作用是将数据包传输到正确的地址，而要完成这一目标则需要满足许多条件。比较重要的两个条件是**MAC地址和IP地址,这两个地址可以搭配使用**
IP地址指明了**节点被分配的地址，是可以改变的**。
MAC地址网卡的**固有地址，是唯一的**。
很少有情况是在局域网内部的两台计算机进行数据传输，通常要通过多台计算机或者网络设备来作为**中转站**。这时我们需要得知下一站的MAC地址来确定下一个跳转的中转站。**ARP(Address Resolution Protocol)协议的作用是，通过通信方的IP地址来确定它的MAC地址。**
**在通信过程中无法无法全面掌控传输过程**
**路由选择机制**，就像寄一个快递包裹，你只需将快递拿到集散中心，集散中心会知道是否肯发货(做出某种判断)，再将货物送给下一个集散中心，下个区域的集散中心再确定能否送到对方家中。

#### 负责确保可靠性的TCP协议

TCP处于传输层，提供可靠的字节流服务。字节流服务是将大的数据块分成以数据报文为单位的数据包。而且TCP协议能够确认对方是否收到了数据包。

##### 三次握手策略

![](https://raw.githubusercontent.com/aryangzhu/blogImage/master/blogImage/images/三次握手.png)
发送端首先会**发送一个带有SYN(synchronized)标识**的数据包，接收端在接收到以后会回传一个**带有SYN/ACK(acknowlege)的标识**传达确认可以接收的信息，然后发送端再发送一个**带有ACK标识**的数据包。至此，"握手"完成。

### 负责域名解析的DNS服务

和HTTP协议一样存在于应用层，功能是**将主机域名解析为IP地址**。例如，想要访问某个网页(www.bilibili.com)，DNS服务会将这个域名转换为IP地址(形如192.168.1.1)。

### 各种协议与HTTP协议的关系

通过下面能够直观地看出IP协议、TCP协议和DNS服务在**使用HTTP协议通信的过程**发挥的作用。
![](https://raw.githubusercontent.com/aryangzhu/blogImage/master/blogImage/images/使用http完整通信过程.png)

### URI和URL

URI-统一资源标识符
URL-统一资源定位符
URI用字符串表示某一互联网的资源，而URL表示资源所在位置。

##### 绝对URI

![](https://gitee.com/aryangzhu/picture/raw/master/%E7%BB%9D%E5%AF%B9URI.png)
**服务器地址**
使用绝对URI必须得有服务器地址，可以是可解析的域名，也可以是IPV4或者IPV6地址。
**带层次的文件地址**
类似于UNIX系统的文件路径。指定服务器上的某个特指资源。
**查询字符串**
针对已指定的文件路径内的资源，进行字符串匹配。
**片段标识符**
取出已获取资源的子资源。

##### 绝对URL

##### 相对URL

形如/iamge/logo.gif

## 二、简单的HTTP协议

### HTTP协议用于客户端和服务端之间的通信

### 通过请求和响应的交换达成通信

HTTP协议要求必须得有一个客户端和一个服务端，并且客户端发送请求由服务端进行响应。

#### 请求报文结构

GET /index.html HTTP/1.1
Host:hackr.jp
Contnection:keep-alive;
name=zhangsan&age=37
**请求方法、请求URI、HTTP协议版本号、报文首部字段、内容实体**

#### 响应报文结构

HTTTP/1.1 200 OK
Date: True, 10.....
\<html>....
**协议版本、状态码、原因短语、首部字、主体**

### HTTP不保存状态

第二次通信时，双方无法得知之前的通信内容是什么。

### 请求URI定位资源

### 告知服务器意图的HTTP方法

### 使用方法下达命令

**GET-获取某个资源**
**POST-传输实体主体(例如想要得知服务器上某个程序执行的结果)**
**PUT-客户端发送/上传文件**
**HEAD-获得报文首部(例如服务器上某个文件的创建时间等等相关信息，不需要返回主体)**
**DELETE-删除文件**
OPTIONS-询问支持的方法
TRACE-追踪路径
Connect-要求建立隧道协议连接代理(SSL-安全套接层)

### 持久连接节省通信量

一开始，**每一次请求之前都需要先建立TCP连接，HTTP响应之后也需要断开TCP连接**。

##### 持久连接

只在**第一次发送HTTP请求时建立TCP连接，最后一次HTTP响应时断开连接**。

##### 管线化

原来情况是第一个请求被响应之后才能继续发送请求，管线化是指第一个请求发送之后，可以继续发送第二个请求。并行化发送请求大大提高了效率。

### 使用Cookie的状态管理

从例子开始，某些网页我们需要进行身份验证。而HTTP协议是无状态的，也就是说服务器不知道客户端圆脸已经验证过身份，想想看，B站如果打开宅舞区需要验证身份，打开鬼畜区还得验证身份，那么用户还不得麻烦死。
Cookie是在客户端发送请求到服务端之后，服务端在响应报文首部字段中添加一个**Set-Cookie**。客户端在后面发送请求时，就会请求报文首部字段中携带上Cookie值。服务端接收请求之后回合服务器上的值进行比较，从而确认是那个客户端发送的请求。

## 三、HTTP内的HTTP信息

### HTTP报文

HTTP报文指的就是发送端和服务端使用HTTP协议时传送的信息，是由**多行字符**串构成。
HTTP报文分为**报文首部**和**实体**，用空格隔开。

### 请求报文和响应报文的结构

之前在学习第二章的时候有提及过，下面是请求报文和响应报文常见的
**请求行**
请求方法、URI和HTTP协议版本。
**状态行**
表示结果的状态码、原因短语和HTTP版本
**首部字段**
请求和响应的**各种条件**和**属性**的首部。一般有4种首部，分别是通用首部、请求首部、响应首部和实体首部。
**其他**
未定义在**RFC(Request for Comments,用来定义HTTP协议技术的标准文档)**中的属性(例如，Cookie)

### 编码提升传输速率-重点

HTTP在传输时可以按照原貌进行传输，不过显然内容过大。为了方便，对HTTP请求进行编码。同时，编码需要消耗CPU资源。

#### 报文主体和实体主体的差异

**报文**(message)-是HTTP报文的**基本单位**。由**8位组字节流**(obtet sequence，obtet是由8个比特)组成，通过HTTP通信传输。
**实体**(entity)-作为请求或响应的**有效载荷数据**,由实体首部和实体主体组成。
**HTTP报文的主体用于传输请求或响应的实体主体**
通常，报文主体和实体主体相等的。在传输时经过编码之后，实体主体的内容将发生变化。

#### 压缩传输的内容编码

一般在发邮件时，我们都会打包成zip等格式。同样，HTTP报文编码之后也能进行压缩。HTTP协议中有一种被称为内容编码的功能。**内容编码声明编码格式，而由服务端进行解码**

#### 分割发送的分块传输编码

当我们请求某个资源，响应报文过大时，可以将**报文分割成多个块分别发送给服务端**，这种功能被称之为分块传输编码(针对实体主体)。每一块都会用16进制标记块的大小，而实体的最后一块会使用"0(CR+LF，换行)"来标记。

#### 发送多种数据的多部分集合

在发送邮件时，可能会携带附件。通过**MIME(Multipurpose Internet Mail Extensions，多用途因特网邮件扩展)机制**。例如，图片等二进制数据以ASCII码字符串编码的方式指明，就是利用MIME来描述标记数据类型。**MIM在扩展中会使用一种称为多部分对象集合(Multipart)的方法，来容纳多分不同数据类型的数据**。相应的，HTTP协议中也采纳了多部分对象集合，**发送的一份数据文件可以包含多种类型实体**。
多部分对象集合包含的对象如下
**multipart/form-data**
这个很常见，在我们上传表单文件发送ajax请求时使用。
**multipart/byteranges**
状态码206时使用，响应报文包含了多个范围的内容时使用。
在使用多部分对象集合时，需要在首部添加Content-Type字段。
通常，我们使用boundary字符串来划分多部分对象集合指明的各类实体。例如"--ABB03x",在多部分对应集合的最后插入"--"标记。

#### 获取部分内容的范围请求

文件下载时，可能因为网络原因中断。如果重新下载很麻烦，为了解决这个问题，出现一种恢复机制。
**请求时需要指定下载的实体范围**。
执行范围请求，会用到Range字段来指定范围。
Ranage:bytes=5001-10000
针对范围请求，响应会返回状态码为**206 Partial Content**的响应报文。如果是多重范围的范围请求。响应报文会在**首部字段Content-Type标明multipart/byteranges后返回响应报文**。

#### 内容协商

内容协商是指客户端和服务端就响应的资源进行交涉，然后返回最合适的资源。**内容协商会以响应资源的语言、文字符集和编码方式等作为判断的标准**。
Content-Language
Accept-Charset

## 四、返回结果的HTTP状态码

### 2xx成功

200 OK

### 3xx重定向

301 Moved Premamently
请求的资源已经被被分配了新的URI，以后应该使用资源现在所指的URI。如果将资源对应的URI存为书签，那么应当按照Location首部字字段提示的URI重新保存。

```html
http://example.com/sample
```

### 4xx 客户端错误

404 Not Found

### 5xx 服务端错误

500 Internetal Server Error

## 五、与HTTP协作的web服务器

### 单台虚拟主体实现了多个域名

HTTP规范允许一台HTTP服务器搭建多个Web站点。利用虚拟服务器的功能，**实现物理层面一台服务器而假想多台服务器**。
由前面的章节我们知道，在访问网站时，DNS会将域名解析成为IP地址。此时，虚拟主体的IP地址已知，但是如何确定访问的是哪个域名呢？这就要求访问时Host首部内有**完整指定主机名或者域名的URI**。

### 通信数据转发程序：代理、网关和隧道

#### 网关

**转发其他服务器通信数据**，自己也可以处理客户端的请求。
与代理类似，但是网关能使通信线路上的服务器提供非HTTP协议服务。

#### 代理

扮演了一个“中间人”的角色，接收客户端请求转发给服务端，也接收服务端响应发送给客户端。
**代理不改变请求URI**
**每经过一台代理服务器，需要追加via首部信息**

##### 缓存代理-Cache Proxy

代理服务器会将资源副本保存在自己的服务器上，等到下次客户端进行访问时，如果资源还是有效的，那么将会由代理服务器直接返回。

##### 透明代理-Transparent Proxy

不对报文做任何修改或者加工处理。

#### 隧道

客户端与服务端之间建立私密(SSL)通道。

### 保存资源的缓存

缓存服务器是代理服务器中的一种，并归类在缓存服务器中。

##### 资源的有效期

即使存在缓存，也会因为客**户端的要求、缓存的有效期**等因素，向源服务器确认资源的有效性。

##### 客户端的缓存

缓存不仅可以存在于服务期内，也可以存在于客户端。例如，熟知的ie浏览器程序，把客户端缓称为临时网络文件(Temporary Internet File)。

## 六、报文首部

### HTTP报文首部

### HTTP首部字段

#### 首部字段传递重要信息

为了给浏览器和服务器提供报文主体大小、所使用的语言、认证信息等内容。

#### HTTP首部字段结构

首部字段名：字段值

#### 4种HTTP首部字段类型

##### 通用首部字段

##### 请求首部字段-重点

##### 响应首部字段-重点

##### 实体首部字段

##### HTTPS

HTTPS 网站必须从**独立证书颁发机构**（CA）获取 **SSL/TLS 证书**。这些网站会在交换数据之前先与浏览器共享该证书，以建立信任。SSL 证书还包含加密信息，以便服务器和 Web 浏览器可以交换加密或刻意打乱的数据。该过程的工作原理是：

1. 您通过在浏览器的地址栏中键入 *https://* URL 格式来访问 HTTPS 网站。
2. 浏览器尝试通过请求服务器的 SSL 证书来验证该站点的真实性。
3. 该服务器发送包含**公钥的 SSL/TLS 证书**作为回复。
4. 该网站的 SSL 证书将证明该服务器身份。浏览器确认一切妥当后，它将使用该公钥加密并发送包含秘密会话密钥的消息。
5. Web 服务器使用其私钥解密消息并检索会话密钥。然后，它将加密该会话密钥，并向浏览器发送确认消息。
6. 现在，浏览器和 Web 服务器都切换到使用相同的会话密钥来安全地交换消息
   ![](https://raw.githubusercontent.com/rayliu445/blogImage/master/blogImage/https%E4%BA%A4%E4%BA%92%E6%B5%81%E7%A8%8B20250414.png)

###### 为什么要选择HTTPS

* 安全性
  浏览器在与网站进行会话时，用户的消息会进行加密，这样即使第三方能够拦截到消息也会因为加密的缘故无法造成危害。
* 权威性
